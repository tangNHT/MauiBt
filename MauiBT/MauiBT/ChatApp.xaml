<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:telerik="http://schemas.telerik.com/2022/xaml/maui"
             x:Class="MauiBT.ChatApp"
             Title="ChatApp"
             Background="White"
             xmlns:local = "clr-namespace:MauiBT.ViewModel">
    <ContentPage.BindingContext>
        <local:ChatViewModel />
    </ContentPage.BindingContext>
    <Grid
        RowDefinitions="Auto, *, Auto"
        ColumnDefinitions="2*, 1, 6.5*, 1, 1.5*">

        <VerticalStackLayout>
            <Label
                Text="App"
                FontSize="16"
                Padding="10"
                FontAttributes="Bold" />
            <telerik:RadBorder
                CornerRadius="10"
                BorderColor="#EEEEEE"
                BorderThickness="1"
                HeightRequest="42"
                HorizontalOptions="Fill"
                Margin="10">
                <HorizontalStackLayout
                    VerticalOptions="Center">
                    <Image
                        Source="search_icon.png"
                        HeightRequest="16"
                        WidthRequest="16"
                        VerticalOptions="Center"
                        Margin="8,0,0,0"
                        Opacity="0.2" />
                    <Entry
                        Placeholder="Search chats"
                        TextColor="Black"
                        PlaceholderColor="#EEEEEE"
                        FontSize="14"
                        HorizontalOptions="Fill"/>
                </HorizontalStackLayout>
            </telerik:RadBorder>
            <CollectionView
                ItemsSource="{Binding Users}"
                Grid.RowSpan="2"
                Grid.Row="1"
                Grid.Column="0"
                Margin="10">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <HorizontalStackLayout
                            Padding="0,5"
                            Spacing="10">
                            <Border
                                StrokeThickness="0"
                                StrokeShape="RoundRectangle 25"
                                WidthRequest="50"
                                HeightRequest="50">
                                <Image
                                    Source="{Binding Avatar}"
                                    Aspect="AspectFill" />
                            </Border>
                            <VerticalStackLayout
                                Margin="10,0,0,0">
                                <Label
                                    Text="{Binding Name}"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    TextColor="Black"
                                    Margin="0,7,0,4"/>
                                <Label
                                    Text="{Binding Chat}"
                                    TextColor="Black"
                                    FontSize="14" />
                            </VerticalStackLayout>
                        </HorizontalStackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
        <BoxView
            Grid.Column="1"
            Grid.RowSpan="3"
            WidthRequest="1"
            BackgroundColor="#E0E0E0" />
        <CollectionView
            Grid.Column="2" Grid.Row="1"
            ItemsSource="{Binding Messages}"
            x:Name="MessageView"
            VerticalOptions="Fill"
            ItemSizingStrategy="MeasureFirstItem">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <StackLayout
                        Padding="5"
                        HorizontalOptions="{Binding IsMine, Converter={StaticResource BoolToLayoutConverter}}"
                        BackgroundColor="{Binding IsMine, Converter={StaticResource BoolToColorConverter}}"
                        Margin="0,2"
                        MinimumWidthRequest="100"
                        MaximumWidthRequest="250"
                        Orientation="Vertical">
                        <Label
                            Text="{Binding Text}"
                            TextColor="White"
                            Margin="0,3" />
                    </StackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Grid
            Grid.Row="2"
            Grid.Column="2"
            Padding="5"
            ColumnDefinitions="9*, *">
            <telerik:RadBorder
                CornerRadius="10"
                BorderColor="#EEEEEE"
                BorderThickness="1"
                HeightRequest="45"
                HorizontalOptions="Fill"
                Margin="10">
                <HorizontalStackLayout>
                    <Entry
                        Grid.Column="0"
                        Placeholder="Enter your message"
                        Text="{Binding NewMessage}"
                        HorizontalOptions="Fill"
                        TextColor="Black" />
                    <Button
                        Text="Send"
                        Grid.Column="1"
                        Command="{Binding SendMessageCommand}" />
                </HorizontalStackLayout>
            </telerik:RadBorder>
        </Grid>
        <BoxView
            Grid.Column="3"
            Grid.RowSpan="3"
            WidthRequest="1"
            BackgroundColor="#E0E0E0" />
        <Grid
            Grid.Column="4"
            Grid.RowSpan="3">
            <VerticalStackLayout>
                <Border
                    Margin="20"
                    StrokeThickness="0"
                    StrokeShape="RoundRectangle 50"
                    WidthRequest="100">
                    <Image
                        Source="image.png"
                        Aspect="AspectFill"
                        WidthRequest="100"
                        HeightRequest="100" />
                </Border>
                <Label>
                    Helena
                </Label>
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>